var shinyTree=function(){callbackCounter=0,sttypes=null;var e=new Shiny.OutputBinding;$.extend(e,{find:function(e){return $(e).find(".shiny-tree")},renderValue:function(e,t){$elem=$("#"+e.id),$elem.jstree("destroy"),$elem.html(t);var n=[];"TRUE"===$elem.data("st-checkbox")&&n.push("checkbox"),"TRUE"===$elem.data("st-search")&&n.push("search"),"TRUE"===$elem.data("st-dnd")&&n.push("dnd"),"TRUE"===$elem.data("st-types")&&n.push("types");$(e).jstree({core:{check_callback:"TRUE"===$elem.data("st-dnd"),themes:{name:$elem.data("st-theme"),responsive:!0,icons:"TRUE"===$elem.data("st-theme-icons"),dots:"TRUE"===$elem.data("st-theme-dots")}},types:sttypes,plugins:n})}}),Shiny.outputBindings.register(e,"shinyTree.treeOutput");var t=new Shiny.InputBinding;$.extend(t,{find:function(e){return $(e).find(".shiny-tree")},getType:function(){return"shinyTree"},getValue:function(e,t){var n=function(e,t){var r=function(e){var t={};return $.each(e,function(e,n){var r={};$.each($("#tree").jstree(!0).get_node(n.id).data,function(e,t){r[e]="string"==typeof t?t.trim():t}),n.data=r,t[""+e]=n}),t},i=[];return $.each(e,function(e,s){s.children&&s.children.length>0&&(s.children=r(n(s.children,t)));var a={};$.each(s,function(e,n){t.indexOf(e)>=0&&(a[e]="string"==typeof n?n.trim():n)}),i.push(a)}),result=r(i),r(result)},r=$.jstree.reference(e);if(r&&r.get_container().find("li").length>0){var i=r.get_json(),s=n(i,["id","state","text","children"]);return callbackCounter++,s.callbackCounter=callbackCounter,s}},setValue:function(e,t){},subscribe:function(e,t){$(e).on("open_node.jstree",function(e){t()}),$(e).on("close_node.jstree",function(e){t()}),$(e).on("changed.jstree",function(e){t()}),$(e).on("ready.jstree",function(e){t()}),$(e).on("move_node.jstree",function(e){t()})},unsubscribe:function(e){$(e).off(".jstree")},receiveMessage:function(e,t){"updateTree"==t.type&&void 0!==t.data&&($(e).jstree(!0).settings.core.data=JSON.parse(t.data),$(e).jstree(!0).refresh(!0,!0))}}),Shiny.inputBindings.register(t);var n={initSearch:function(e,t){$(function(){var n=!1;$("#"+t).keyup(function(){n&&clearTimeout(n),n=setTimeout(function(){var n=$("#"+t).val();$.jstree.reference("#"+e).search(n)},250)})})}};return n}();