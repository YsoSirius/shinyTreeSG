var shinyTree=function(){callbackCounter=0,sttypes=null;var e=new Shiny.OutputBinding;$.extend(e,{find:function(e){return $(e).find(".shiny-tree")},renderValue:function(e,t){$elem=$("#"+e.id),$elem.jstree("destroy"),$elem.html(t);var n=[];"TRUE"===$elem.data("st-checkbox")&&n.push("checkbox"),"TRUE"===$elem.data("st-search")&&n.push("search"),"TRUE"===$elem.data("st-dnd")&&n.push("dnd"),"TRUE"===$elem.data("st-types")&&n.push("types"),"TRUE"===$elem.data("st-contextmenu")&&n.push("contextmenu"),"TRUE"===$elem.data("st-state")&&n.push("state"),"TRUE"===$elem.data("st-unique")&&n.push("unique"),"TRUE"===$elem.data("st-sort")&&n.push("sort"),"TRUE"===$elem.data("st-wholerow")&&n.push("wholerow");$(e).jstree({core:{check_callback:"TRUE"===$elem.data("st-dnd"),themes:{name:$elem.data("st-theme"),responsive:!0,icons:"TRUE"===$elem.data("st-theme-icons"),dots:"TRUE"===$elem.data("st-theme-dots")},state:{key:"jstree"}},types:sttypes,plugins:n})}}),Shiny.outputBindings.register(e,"shinyTree.treeOutput");var t=new Shiny.InputBinding;$.extend(t,{find:function(e){return $(e).find(".shiny-tree")},getType:function(){return"shinyTree"},getValue:function(e,t){var n=function(e,t){var s=function(e){var t={};return $.each(e,function(e,n){t[""+e]=n}),t},r=[];return t.push("children"),$.each(e,function(e,i){i.children&&i.children.length>0&&(i.children=s(n(i.children,t)));var a={};$.each(i,function(e,n){t.indexOf(e)>=0&&("li_attr"===e?(n.stid&&("string"==typeof n.stid?a.stid=n.stid.trim():a.stid=n.stid),n.class&&("string"==typeof n.class?a.stclass=n.class.trim():a.stclass=n.class)):a[e]="string"==typeof n?n.trim():n)}),r.push(a)}),s(r)},s=$.jstree.reference(e);if(s&&s.get_container().find("li").length>0){var r=s.get_json(),i=n(r,["id","state","text","li_attr"]);return callbackCounter++,i.callbackCounter=callbackCounter,i}},setValue:function(e,t){},subscribe:function(e,t){$(e).on("close_node.jstree",function(e){t()}),$(e).on("set_state.jstree",function(e){t()}),$(e).on("open_node.jstree",function(e){t()}),$(e).on("changed.jstree",function(e){t()}),$(e).on("ready.jstree",function(e){t()}),$(e).on("move_node.jstree",function(e){t()}),$(e).on("search.jstree",function(e){t()}),$(e).on("clear_search.jstree",function(e){t()})},unsubscribe:function(e){$(e).off(".jstree")},receiveMessage:function(e,t){"updateTree"==t.type&&void 0!==t.data&&($(e).jstree(!0).settings.core.data=JSON.parse(t.data),$(e).jstree(!0).refresh(t.skipload,t.fortgetstate))}}),Shiny.inputBindings.register(t);var n={initSearch:function(e,t,n){$(function(){var s=!1;$("#"+t).keyup(function(){s&&clearTimeout(s),s=setTimeout(function(){var n=$("#"+t).val();$.jstree.reference("#"+e).search(n)},n)})})}};return n}();